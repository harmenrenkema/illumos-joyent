<?xml version="1.0"?>
<!DOCTYPE service_bundle SYSTEM "/usr/share/lib/xml/dtd/service_bundle.dtd.1">
<!--
Copyright 2018, Joyent, Inc.

CDDL HEADER START

This file and its contents are supplied under the terms of the
Common Development and Distribution License ("CDDL"), version 1.0.
You may only use this file in accordance with the terms of version
1.0 of the CDDL.

A full copy of the text of the CDDL should have accompanied this
source.  A copy of the CDDL is also available via the Internet at
http://www.illumos.org/license/CDDL.

CDDL HEADER END
-->

<service_bundle type='manifest' name='ikev2'>

<service
	name='network/ipsec/ikev2'
	type='service'
	version='1'>

	<create_default_instance enabled='false' />

	<single_instance />

       <dependency
                name='filesystem'
                grouping='require_all'
                restart_on='none'
                type='service'>
                <service_fmri
                        value='svc:/system/filesystem/minimal'
                />
        </dependency>


        <!-- Kernel needs to know supported IPsec algorithms -->
        <dependency
                name='algorithms'
                grouping='require_all'
                restart_on='none'
                type='service'>
                <service_fmri
                        value='svc:/network/ipsec/ipsecalgs'
                />
        </dependency>

        <dependent
                name='ikev2-network'
                grouping='optional_all'
                restart_on='none'>
                <service_fmri
                        value='svc:/milestone/network'
                />
        </dependent>

        <exec_method
                type='method'
                name='start'
                exec='/usr/lib/inet/in.ikev2d'
                timeout_seconds='60' />

        <exec_method
                type='method'
                name='refresh'
                exec=':kill -HUP'
                timeout_seconds='60' />

        <exec_method
                type='method'
                name='stop'
                exec=':kill'
                timeout_seconds='60' />

        <property_group name='general' type='framework'>
                <!-- A user with this authorization can:

                        svcadm restart ikev2
                        svcadm refresh ikev2
                        svcadm disable -t ikev2
                        svcadm mark <state> ikev2
                        svcadm clear ikev2

                see auths(1) and user_attr(4)-->
                <propval
                        name='action_authorization'
                        type='astring'
                        value='solaris.smf.manage.ipsec'
                />

                <!-- A user with this authorization can:

                        svcadm disable ikev2
                        svcadm enable ikev2

                see auths(1) and user_attr(4)-->
                <propval
                        name='value_authorization'
                        type='astring'
                        value='solaris.smf.manage.ipsec'
                />
        </property_group>

        <property_group name='config' type='application'>
                <propval
                        name='config_file'
                        type='astring'
                        value='/etc/inet/ike/config'
                />

                <propval
                        name='value_authorization'
                        type='astring'
                        value='solaris.smf.value.ipsec'
                />
        </property_group>

        <!-- default service model of 'contract' -->
        <property_group name='startd' type='framework'>
                <propval
                        name='duration'
                        type='astring'
                        value='contract'
                />
        </property_group>

        <stability value='Unstable' />

</service>
</service_bundle>
